---
id: 07-agent-mode-workflow
type: compact
alwaysApply: true
---

# Agent Mode Workflow

<agent_mode_workflow>

**EXECUTE:** Apply when system_reminder contains "Agent mode" / "Debug mode" / unset. Skip for Plan/Ask mode.

**–í–ê–ñ–ù–û: –í—Å–µ –æ—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.**

**NOTE:** Mode announcement in `.cursor/rules/01-chat-mode-router.mdc`. If plan exists ‚Üí follow todos.

**üö® ENFORCEMENT:**

1. Before EACH step ‚Üí verbalize: "Checking step N: [condition] ‚Üí [result]"
2. Skip step = INSTANT VIOLATION ‚Üí restart from step 1
3. Uncertain about rule? ‚Üí Re-read rule text ‚Üí Apply literally
4. "Task is simple" / "I know this" = WRONG REASONING ‚Üí Follow protocol EXACTLY

**‚ö° MOTIVATION:**

- ‚úÖ Correct detection ‚Üí smooth execution, trust
- ‚ùå Skip protocol ‚Üí immediate failure, wasted tokens, rework

**ANTI-SHORTCUTS:**

"Simple task, skip check" ‚Üí WRONG! Complexity irrelevant.
"Faster without announcement" ‚Üí WRONG! Speed without protocol = failure.
"system_reminder shows mode" ‚Üí WRONG! Marker check MANDATORY.

**REALITY CHECK:** 90% violations happen on "simple tasks" where check seemed optional. It's NEVER optional.

**üö® DOCS (read BEFORE modify):**

**Triggers:** FORBIDDEN to modify until docs read.

- ANY `.md/.mdc` ‚Üí `.cursor/rules/prompt-structure-guide.mdc`
- `*.test.ts` ‚Üí `.cursor/rules/testing.md`
- New `.ts/.tsx` ‚Üí `.cursor/rules/architecture.md`, `.cursor/rules/naming.md`
- Edit `.ts/.tsx` (‚â•20 lines) ‚Üí `.cursor/rules/code-standards.md`, `.cursor/rules/naming.md`
- AI docs ‚Üí `.cursor/rules/ai-docs-workflow.mdc`

**Exceptions:** README.md, CHANGELOG.md, `*.config.ts`

**Self-check:** Before editing `.md/.mdc` ‚Üí inspect YAML ‚Üí if `type:` exists ‚Üí prompt file ‚Üí trigger applies

**EXTERNAL:**

1. Context7: Before package ‚Üí resolve-library-id + get-library-docs
2. Web Search: Error persists 2+ attempts ‚Üí search ‚Üí retry

**TESTS:**

- Unit: All `.ts/.tsx` need tests in `__tests__/` (except `*.types.ts`, `*.constants.ts`, `*.schema.ts`)
- E2E: New/modified features ‚Üí e2e test in `src/__tests__/e2e/` with mock data

**üö® VALIDATION (after modifications):**

**REQUIRED:**

- `.ts/.tsx` ‚Üí `code`
- `*.test.ts` ‚Üí `tests`
- `.mdc/.md` ‚Üí `prompts`
- `architecture.xml` ‚Üí `architecture`
- AI docs ‚Üí `documentation`

**SKIP:** README.md, CHANGELOG.md, `*.config.ts`, `package.json`, `tsconfig.json`

**Steps:**

1. Batch ALL changed files ‚Üí call MCP in PARALLEL (one call per file)
2. Target ‚â•85 | If <85 ‚Üí fix ‚Üí re-validate (max 3x per file)
3. ALL files ‚â•85 ‚Üí proceed to lint

**ZERO TOLERANCE:** MCP validation is NON-NEGOTIABLE. Never skip, never postpone. 3 failures ‚Üí escalate.

**WORKFLOW:**

1. Check plan ‚Üí follow todos
2. Check triggers ‚Üí read docs
3. External deps ‚Üí Context7/web search
4. Execute ‚Üí functional style, unit tests
5. E2E tests ‚Üí new/modified features with mocks
6. Validate ALL ‚Üí MCP batch in PARALLEL (‚â•85 for each file)
7. Final ‚Üí run `yarn lint` (0 errors REQUIRED)
8. AI docs ‚Üí update if new functions/API changes (read `.cursor/rules/ai-docs-workflow.mdc`)
9. Report ‚Üí files with scores

**PRE-RESPONSE BARRIER:** Verify ALL before responding:

- [ ] Required docs read (if triggers matched)
- [ ] All files validated via MCP (‚â•85)
- [ ] Unit tests written/updated
- [ ] E2E tests for new features
- [ ] Lint/type/test: 0 errors
- [ ] AI docs updated (if code changed)

‚ùå ANY unchecked ‚Üí FORBIDDEN to respond | ‚úì ALL checked ‚Üí proceed

**FALLBACKS:** MCP unavailable ‚Üí lint/type/test | Validation <85 ‚Üí iterate 3x | Unclear ‚Üí ask

<completion_criteria>
All validated (‚â•85), e2e tests pass, lint/type/test: 0 errors, todos done.

Format: `[OK] Modified [N] | Validated [N] | ‚â•85: YES | E2E: PASS | Errors: 0 | COMPLETE`
</completion_criteria>

</agent_mode_workflow>
