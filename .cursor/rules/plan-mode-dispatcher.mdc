---
id: plan-mode-dispatcher
type: compact
alwaysApply: false
---

# Plan Mode Dispatcher

<plan_mode_dispatcher>

**ACTIVATION:** Run only when "Plan mode is active" in system_reminder; otherwise skip.

**NOTE:** Mode announcement handled by `.cursor/rules/01-chat-mode-router.mdc`.

**FIRST ACTION:** Classify activity type before ANY response. Skipping = plan aborts.

**BLOCKING GATE BEFORE create_plan**

PROHIBIT create_plan unless all checks pass:

[ ] Type classified
[ ] Type announced: "ðŸ“‹ [type] â†’ ðŸ“„ .cursor/rules/[name].mdc â†’ Following as primary instructions"
[ ] Workflow read: read_file('.cursor/rules/[name].mdc') in same batch
[ ] Content received

IF any check fails â†’ abort, retry max 3 times, then report error

**AFTER PLAN EXECUTION (CRITICAL):**

When user approves plan and execution starts:

1. Output: `[MODE_INITIALIZED: AGENT_MODE] â†’ ðŸ“„ .cursor/rules/07-agent-mode-workflow.mdc â†’ Following as primary instructions (already loaded)`

**Classification Algorithm**

1. READ user request for codes ONLY
2. CHECK codes: `td*` â†’ instant match â†’ go to step 5
3. IF no code â†’ check file extensions â†’ match from table
4. IF no match â†’ analyze keywords and context â†’ select highest density
5. SELECT type â†’ IF tie â†’ first from Activity Types table
6. ANNOUNCE: `ðŸ“‹ [type] â†’ ðŸ“„ .cursor/rules/[name].mdc â†’ Following as primary instructions`
7. READ: read_file('.cursor/rules/[name].mdc') in same batch
8. VERIFY: content received â†’ IF failed â†’ abort, report error with file path
9. PROCEED: create_plan

IF no match at step 5 â†’ DEFAULT to Code Development

**Priority:** Codes > Extensions > Keywords > Context > Default (tie: first from table)

**Language support:** Analyze requests in ANY language - detect intent patterns, not exact matches

**Activity Types**

| Activity | Codes | Key Triggers | File |
|:---|:---|:---|:---|
| Prompt Engineering | `tdprompt` | `.cursor/`, `.mdc`, "prompt", "rules", "AI behavior", "workflow", "dispatcher", "improve prompt", "rewrite prompt" | `.cursor/rules/prompt-workflow.mdc` |
| Code Development | `tdcode` | `.ts`, `.tsx`, `.js`, `.jsx`, "bug", "fix", "implement", "function", "refactor" | `.cursor/rules/code-workflow.mdc` |
| UI Development | `tdui` | "ui", "interface", "visual", "styles", "component", "layout", "design" | `.cursor/rules/ui-workflow.mdc` |
| AI Documentation | `tdaidoc` | "ai-docs", "package-ai-docs", "module-ai-docs", "module documentation", "YAML", "DiÃ¡taxis", "update documentation" | `.cursor/rules/ai-docs-workflow.mdc` |
| Technical Critique | `tdcritic` | "critique", "review", "evaluate", "code review", "analysis" | `.cursor/rules/critique-workflow.mdc` |
| JIRA Task | `tdjira` | "JIRA task", "technical spec", "create task" | `.cursor/rules/jira-task-creator.mdc` |
| Auxiliary Dev | `tdaux` | "script", "deploy", "automation", "CI/CD", "config" | `.cursor/rules/auxiliary-code-workflow.mdc` |

**FORBIDDEN:**

- create_plan before classification
- Questions before read_file
- Skip announcement

**Example:** `ðŸ“‹ Prompt Engineering â†’ ðŸ“„ .cursor/rules/prompt-workflow.mdc â†’ Following as primary instructions`

</plan_mode_dispatcher>
