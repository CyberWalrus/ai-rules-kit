---
id: plan-mode-dispatcher
type: compact
alwaysApply: false
---

# Plan Mode Dispatcher

<plan_mode_dispatcher>

**ACTIVATION:** Execute only when "Plan mode is active" in system_reminder; otherwise skip.

**CRITICAL FIRST ACTION**

Before ANY response:

1. Self-check: "Did I output 'Identified activity types: [type]'?"
   - NO → BLOCKING VIOLATION → Execute classification NOW
   - YES → Proceed

PROHIBITION: Analyze task before classification.

CONSEQUENCE: Skip → wrong workflow → plan failure.

**BLOCKING GATE BEFORE create_plan**

PROHIBITION to call create_plan unless ALL checked:

[ ] Type classified
[ ] Type announced: "Identified activity types: [type]"
[ ] Workflow read: read_file('[name].mdc') in same batch
[ ] Content received

IF unchecked → ABORT → complete missing → retry

**Classification Algorithm**

1. READ user request
2. CHECK codes: `td*` → instant match
3. IF no code → ANALYZE meaning → match table
4. SELECT type (most probable)
5. ANNOUNCE: "Identified activity types: [type], reading file [name].mdc"
6. READ: read_file('[name].mdc') in same batch
7. VERIFY: content received
8. PROCEED: create_plan

Otherwise → DEFAULT: Set type = Code Development, repeat steps 5-8.

**Activity Types**

| Activity | Codes | Key Triggers | File |
|:---|:---|:---|:---|
| Prompt Engineering | `tdprompt` `тдпромпт` | `.cursor/`, "prompt", "AI behavior" | `prompt-workflow-compact.mdc` |
| Code Development | `tdcode` `тдкод` | ".ts/.js", "bug", "fix", "implement" | `code-workflow.mdc` |
| UI Development | `tdui` `тдюай` | "ui", "visual", "styles", "layout" | `ui-workflow.mdc` |
| AI Documentation | `tdaidoc` `тдаидок` | "ai-docs", "YAML", "Diátaxis" | `ai-docs-workflow.mdc` |
| Technical Critique | `tdcritic` `тдкритик` | "critique", "review", "evaluate" | `critique-workflow.mdc` |
| JIRA Task | `tdjira` `тдджира` | "JIRA task", "technical spec" | `jira-task-creator.mdc` |
| Auxiliary Dev | `tdaux` `тдвсп` | "script", "deploy", "automation" | `auxiliary-code-workflow.mdc` |

**Execution Protocol**

1. CLASSIFY type
2. ANNOUNCE: "Identified activity types: [type], reading file [name].mdc"
3. READ: read_file('[name].mdc') in SAME batch
4. VERIFY: content received
5. CREATE: create_plan

**Self-Verification**

After reading this prompt:

1. First action? → classify type
2. Create_plan without workflow? → NO
3. Announce before read_file? → YES: "Identified activity types: [type], reading file [name].mdc"

FORBIDDEN:

- create_plan before classification
- Questions before read_file
- Skip announcement

**Examples**

CORRECT:

```
Identified activity types: Prompt Engineering, reading file prompt-workflow-compact.mdc
[read_file same batch]
[content received]
[creates plan]
```

WRONG:

```
[Analyzes without "Identified activity types"]
[create_plan without classification] ← VIOLATION
```

CONSEQUENCE: Wrong workflow → plan failure.

</plan_mode_dispatcher>
